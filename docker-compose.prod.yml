services:
  job-search-app:
    build:
      context: .  # Points to the current directory
      dockerfile: dockerfile.prod  # Use the production Dockerfile
    ports:
      - "8000:8000"  # Exposes the backend on port 8000
    environment:
      - DEBUG=False  # Disable debugging in production
      - DJANGO_SECRET_KEY=${DJANGO_SECRET_KEY}
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_HOST=${DB_HOST}
      - DB_PORT=3306
    depends_on:
      - db  # Waits for the database to be ready
    container_name: job-search-prod-container
    restart: always  # Ensures it restarts on failure

  # Optional: Nginx for serving static files
  nginx:
    image: nginx:latest
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro  # Custom Nginx configuration
    depends_on:
      - job-search-app
    container_name: job-search-nginx
    restart: always
